<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Camargue: Catch Unit Tests</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Camargue
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Catch Unit Tests </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This file describes how to interactively use the Catch unit tests that were used to develop Camargue. For information on installing Catch and building in test mode, see the ../../externals/extdeps.md "general external dependencies
documentation". Henceforth we'll assume Catch is installed, and that all the test data has been generated with a call to </p><pre class="fragment">./make_test_data.sh
</pre><h2>Running the tests </h2>
<p>Compiling with <code>make test</code> defines a new main function for Camargue that is provided by Catch. You can run </p><pre class="fragment">./camargue
</pre><p>but this might not be what you want: this runs <em>every single</em> test case programmed, and will probably take 20-40 minutes to run. More likely, you want to examine tests for smaller chunks of code.</p>
<p>Catch offers a tagging system to label test cases, and I have used this to indicate logical units of the code that are covered by a given test. These mostly correspond to namespaces, class names, or function names. To give some examples, </p><pre class="fragment">./camargue '[Sep]'
</pre><p>will run all tests associated to the namespace <a class="el" href="namespace_c_m_r_1_1_sep.html" title="Classes and functions related to cut separation. ">CMR::Sep</a>, for matters related to separation routines. And </p><pre class="fragment">./camargue '[HyperGraph]'
</pre><p>will run tests corresponding to the class <a class="el" href="class_c_m_r_1_1_sep_1_1_hyper_graph.html" title="External representation of a cut added to the lp relaxation. ">CMR::Sep::HyperGraph</a>. To increase the specificity even further, </p><pre class="fragment">./camargue '[get_coeffs]'
</pre><p>will test the method <a class="el" href="class_c_m_r_1_1_sep_1_1_hyper_graph.html#a114c434dd2e4bb0c713ad340dfc43dc2" title="Get sparse coefficient row for a list of endpoints. ">CMR::Sep::HyperGraph::get_coeffs</a>. In some special cases, the tag will refer to a class member. For example, I used the tests in </p><pre class="fragment">./camargue '[adj_zones]'
</pre><p>to do brute force testing of the adjacency zone technique I developed for candidate teeth separation.</p>
<p>Catch also offers a natural syntax for combining or excluding test cases. The logical "and" syntax looks like this: </p><pre class="fragment">./camargue '[Sep][LP]'
</pre><p>will run all tests tagged with both the namespaces <a class="el" href="namespace_c_m_r_1_1_sep.html" title="Classes and functions related to cut separation. ">CMR::Sep</a> and <a class="el" href="namespace_c_m_r_1_1_l_p.html" title="Manners related to LP relaxations and solver interfaces. ">CMR::LP</a>, indicating that they should test operations that make nontrivial use of facilities from both namespaces. Comma separated lists such as <code>[Sep],[LP]</code> indicate a logical "or", and a tilde can exclude a tag. For example </p><pre class="fragment">./camargue '[Solver]~[random]'
</pre><p>will run tests of <a class="el" href="class_c_m_r_1_1_solver.html" title="Solution of TSP instances. ">CMR::Solver</a> while excluding the tag <code>[random]</code>, which I used to label test cases with randomly generated Euclidean instances. You can try typing in any names of namespaces and classes that you like to see if tests exist for them, but you can also run </p><pre class="fragment">./camargue -t
</pre><p>to list all the test case tags.</p>
<p>In most of these cases, Camargue and Catch will probably report that no errors occurred, but it might not be clear what was being done in the first place. By default, Catch only reports names and conditions of test cases when they fail. To override this behavior, run the tests with the flag <code>-s</code>. Then, every test case will explicitly report what was being tested along with assertions that succeeded or failed. So </p><pre class="fragment">./camargue '[DPwitness]' -s
</pre><p>will run tests of the class <a class="el" href="class_c_m_r_1_1_sep_1_1_d_pwitness.html" title="Class for building miniature simple DP witness cutgraphs. ">CMR::Sep::DPwitness</a>, and each case will be reported like</p>
<blockquote class="doxtable">
<p>Scenario: Finding simple DP inequalities via karp partition witnesses</p>
<p>Given: A karp partition and candidate teeth for pcb3038</p>
<p>Then: We can get simple DP inequalities in a mini cutgraph </p>
</blockquote>
<p>This is probably more than enough info to get started running the Camargue test cases, but if you want to know more about using tags, or how Catch works, the documentation on the <a href="https://github.com/philsquared/Catch">Catch GitHub page</a> is helpful.</p>
<h2>Special tests and tags </h2>
<p>In truth, running <code>./camargue</code> won't run quite every single test: Catch also offers the tag <code>[!hide]</code> or <code>[.]</code> to mark test cases as hidden, so that they don't run by default. I have used the hiding tag in only a couple situations.</p>
<p>Tests with the tag <code>[valgrind]</code> are marked as hidden, but can be invoked directly with </p><pre class="fragment">./camargue '[valgrind]'
</pre><p>These tests mostly consist of cases where I have deliberately caused constructor errors in classes which manage C resources and are responsible for freeing managed memory upon destruction. As the name suggests, you are invited to run them with <a href="http://valgrind.org/">Valgrind</a> to see that no memory is leaked during exception conditions.</p>
<p>Similarly, tests with the tag <code>[!shouldfail]</code> are marked by Catch as hidden by default. As the name suggests, these are tests of the error handling control flow in Camargue. They ensure that the program terminates as expected if provided with bad inputs.</p>
<p>Another notable use of the hidden tags is described in the next section.</p>
<h2>Thesis Experiments </h2>
<p>In developing Camargue, I have used Catch not only to test the code for bugs, but to generate benchmarks, tables, and figures that are reported in my thesis. These are implemented through the hidden tag system, as described in the previous section. In particular you can try tests like </p><pre class="fragment">./camargue '[.benchmark]'
./camargue '[.figure]'
./camargue '[.table]'
</pre><p>to run tests that correspond to thesis results. Tests with `'[figure]'` will usually write tours/coordinates/LP solutions to file, which can then be rendered with some sort of graph visualization software. With `'[.benchmark]'<code>or</code>'[.table]'`, sometimes the tests will produce almost verbatim a tab-separated table which was then copied into my thesis. In other cases, a bit of extra processing was used to format or interpret the data. For all of these, I would suggest running with the <code>-s</code> flag, as described previously, to get an idea of what the results actually mean. Additionally, you may want to browse the source of the test case as well to determine which summary statistic was being used.</p>
<p>Note the <code>.</code> prefix on all the test cases: they are all hidden by default because many of them run <em>extremely</em> slowly, given that they try to provide empirical evidence for one approach being faster than another. On top of this, some of them run these slow trials 5 or 10 or 20+ times, so as to record mean CPU times.</p>
<p>At the end of the chapter on simple DP cuts, I report on several different experiments with the TSPLIB instance pla85900. A bit more work is required with these, since they involve modifying parameters which are determined at compile time. They are associated to the tags `'[.sdp-pla85]'<code>and such, and more detailed instructions for running them are given in</code>simpleDP_test.cpp`.</p>
<p>The tag `'[experiment]'` is also employed in a very limited fashion: tests with this tag were used to get a sense of the workings of certain aspects of the solution process, so as to guide implementation choices.</p>
<h2>Reading the tests </h2>
<p>Hopefully the use of tags and the <code>-s</code> flag described above will give a satisfying impression of what the tests are doing while making it easy to target specific parts of the code for testing. If some of these are unclear (or if you're unconvinced about test successes!), you are invited to examine the test implementation files yourself. Test cases are written in the Behavior-Driven Development style, usually with a full sentence describing the behavior of each part. The hope is that this, combined with the natural syntax of Catch, will make the tests more or less self-documenting.</p>
<p>That being said, the source files themselves are much less readable than the rest of the source code. There are around 4,500 source lines of test code, and a lot of it is repetitive boilerplate that could probably be abstracted somehow. Similarly, some of the tests that produce formatted tables do so using some fairly lamentable array-indexing tricks. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
